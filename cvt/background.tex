In this section, we briefly introduce the ISDF decomposition 
\cite{JCP_302_329_2015_ISDF} evaluated using the method developed in Ref. 
\cite{JCTC_2017_ISDF}, which employs a separate treatment of the interpolation
points and interpolation vectors.

First, assume the interpolation points $\{\rhat_\mu\}_{\mu=1}^{N_{\mu}}$ are
known, then the interpolation vectors can be efficiently evaluated using a least
squares method as follows. Using a linear algebra notation, 
\cref{eqn:isdfformat} can be written as
\begin{equation}\label{eqn:isdflineq}
  Z \approx \Theta C\,,
\end{equation}
where each column of $Z$ is given by $Z_{ij}(r)=\varphi_{i}(r)\psi_{j}(r)$
sampled on a dense real space grids $\{r_{i}\}_{i=1}^{N_g}$, and $\Theta = 
[\zeta_1, \zeta_2, ..., \zeta_{N_{\mu}}]$ contains the interpolating vectors.
Each column of $C$ indexed by $(i,j)$ is given by
\begin{equation}
	\left[ \varphi_{i}(\rhat_1)\psi_{j}(\rhat_1),\; \cdots,\;
  \varphi_{i}(\rhat_\mu)\psi_{j}(\rhat_\mu),\; \cdots,\;
  \varphi_{i}(\rhat_{N_{\mu}})\psi_{j}(\rhat_{N_{\mu}})\right]^T\,.
\end{equation}
\cref{eqn:isdflineq} is an overdetermined linear system with respect to the
interpolation vectors $\Theta$. The least squares approximation to the solution
is given by
\begin{equation}\label{eq:Theta}
  \Theta = ZC^T (CC^T)^{-1}.
\end{equation}
It may appear that the matrix\hyp{}matrix multiplications $ZC^T$ and
$CC^T$ take $\calO(N_{e}^{4})$ operations because the size of $Z$ is $N_g
\times N^2$ and the size of $C$ is $N_{\mu} \times N^2$.  However, both
multiplications can be carried out with fewer operations due to the separable
structure of $Z$ and $C$. The computational complexity for computing the
interpolation vectors is $\calO(N_{e}^{3})$, and numerical results indicate that
the pre\hyp{}constant is also much smaller than that involved in hybrid
functional calculations \cite{JCTC_2017_ISDF}. Hence the interpolation vectors
can be obtained efficiently using the least squares procedure.

The problem for finding a suitable set of interpolation points $\{\rhat_\mu\}_
{\mu=1}^{N_{\mu}}$ can be formulated as the following linear algebra problem.
Consider the discretized matrix $Z$ of size $N_{g}\times N^2$, and find $N_
{\mu}$ rows of $Z$ so that the rest of the rows of $Z$ can be approximated by
the linear combination of the selected $N_{\mu}$ rows. This is called an
interpolative decomposition \cite{SIAM_13_727_1992_QRCP}, and a standard method
to achieve such a decomposition is the \emph{QR factorization with column
pivoting} (QRCP) procedure \cite{SIAM_13_727_1992_QRCP} as
\begin{equation}\label{eqn:QRCP}
  Z^{T} \Pi = QR.
\end{equation}
Here $Z^T$ is the transpose of $Z$, $Q$ is an $N^2 \times N_g$ matrix that
has orthonormal columns, $R$ is an upper triangular matrix, and $\Pi$ is a
permutation matrix chosen so that the magnitude of the diagonal elements of
$R$ form an non\hyp{}increasing sequence.  The magnitude of each diagonal
element $R$ indicates how important the corresponding column of the permuted
$Z^T$ is, and whether the corresponding grid point should be chosen as an
interpolation point. The QRCP factorization can be terminated when the $(N_
{\mu}+1)$-th diagonal element of $R$ becomes less than a predetermined
threshold. The leading $N_{\mu}$ columns of the permuted $Z^T$ are considered to
be linearly independent numerically. The corresponding grid points are chosen
as the interpolation points. The indices for the chosen interpolation points 
$\{\rhat_\mu\}$ can be obtained from indices of the nonzero entries of the first
$N_{\mu}$ columns of the permutation matrix $\Pi$.

The QRCP decomposition satisfies the requirements (1) and (2) discussed in 
\cref{cvtsec:int}. First, QRCP permutes matrix columns of $Z^{T}$ with large
norms to the front, and pushes matrix columns of $Z^{T}$ with small norms to
the back. Note that the square of the vector 2\hyp{}norm of the column of $Z^
{T}$ labeled by $r$ is just
\begin{equation}\label{eqn:Znorm}
  \sum_{i,j=1}^{N} \varphi_{i}^2(r) \varphi_{j}^2(r) = \left(\sum_{i=1}^{N}
  \varphi_{i}^2(r)\right) \left(\sum_{j=1}^{N}\psi_{j}^2(r)\right)\,.
\end{equation}
In the case when $\varphi_{i},\psi_{j}$ are the set of occupied orbitals, the
norm of each column of $Z^{T}$ is simply the electron density. Hence the
interpolation points chosen by QRCP will occur where the electron density is
significant. Second, once a column is selected, all other columns are
immediately orthogonalized with respect to the chosen column. Hence nearly
linearly dependent matrix columns will not be selected repeatedly. As a result,
the interpolation points chosen by QRCP are well separated spatially.

It turns out that the direct application of the QRCP procedure (\cref{eqn:QRCP})
still requires $\calO(N_{e}^{4})$ computational complexity. The key idea used in
Ref.~\cite{JCP_302_329_2015_ISDF} to lower the cost is to randomly subsample
columns of the matrix $Z$ to form a smaller matrix $\Ztilde$ of size $N_
{g}\times \widetilde{N}_\mu$, where $\widetilde{N}_\mu$ is only slightly larger
than $N_{\mu}$.  Applying the QRCP procedure to this subsampled matrix $\Ztilde$
approximately yields the choice of interpolation points, but the computational
complexity is reduced to $\calO(N_{e}^3)$. In the context of hybrid density
functional calculations, the cost of the randomized QRCP method can be
comparable to that of applying the exchange operator in the planewave basis set 
\cite{JCTC_2017_ISDF}. However, the ISDF decomposition can still significantly
reduce the computational cost, since the interpolation points only need to be
performed once for a fixed geometric configuration.